<html lang="en">
  <head>
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="104792764153-p2lcgg3f1phjc4etgb1u8phr76qn502k.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <link rel="stylesheet" href="../stylesheets/main.css">
    <form name="gform" id="gform" method="get" enctype="text/plain" action="https://docs.google.com/forms/d/1O8IK0CMt_ijDpFhnqUBHYqVk-Q2a_Yc-xisyVjLsKAc/formResponse"  target="hidden_iframe" onsubmit="submitted=true;">
   
        <label>
          <span class="reqname">Name of Requestee: <span class="required">*</span></span>
          <input type="text" name="entry.1350583608" id="entry.1350583608" placeholder="ex: John Doe" maxlength="30" size="30" required>
        </label>
        <!-- Hidden email field to be submitted with form -->
        <input type="hidden" name="entry.328273392" id="entry.328273392">
        <label>
          <span class="facname">Facility Name: <span class="required">*</span></span>
          <input type="text" name="entry.385453401" id="entry.385453401" placeholder="ex: Admin Building or provide address" maxlength="40" size="40" required>
        </label>
        <label>
          <span class="eventloc" >Room (be specific): <span class="required">*</span></span>
          <input type="text" name="entry.502029463" id="entry.502029463" placeholder="ex: Texas I, Lonestar, or use description" maxlength="40" size="40" required>
        </label>
        <label>
          <span class="phonenum">Phone #: <span class="required">*</span></span>
          <input type="text" name="entry.351618291" id="entry.351618291" placeholder="ex: 123-456-7890" maxlength="15" size="15" required>
        </label>
        <label>
          <span class="reqdate">Requested Date: <span class="required">*</span></span>
          <input type="date" style="width:150px" name="entry.454229218" id="entry.454229218" required>
        </label><br>
        <label>
          <span class="seltime">Requested Time: <span class="required">*</span></span>
          <select name="entry.619950903" id="entry.619950903" style="width:100px;" required>
            <option disabled selected value> ----- </option>
            <option value="7:00 AM">7:00 AM</option>
            <option value="7:15 AM">7:15 AM</option>
            <option value="7:30 AM">7:30 AM</option>
            <option value="7:45 AM">7:45 AM</option>
            <option value="8:00 AM">8:00 AM</option>
            <option value="8:15 AM">8:15 AM</option>
            <option value="8:30 AM">8:30 AM</option>
            <option value="8:45 AM">8:45 AM</option>
            <option value="9:00 AM">9:00 AM</option>
            <option value="9:15 AM">9:15 AM</option>
            <option value="9:30 AM">9:30 AM</option>
            <option value="9:45 AM">9:45 AM</option>
            <option value="10:00 AM">10:00 AM</option>
            <option value="10:15 AM">10:15 AM</option>
            <option value="10:30 AM">10:30 AM</option>
            <option value="10:45 AM">10:45 AM</option>
            <option value="11:00 AM">11:00 AM</option>
            <option value="11:15 AM">11:15 AM</option>
            <option value="11:30 AM">11:30 AM</option>
            <option value="11:45 AM">11:45 AM</option>
            <option value="12:00 PM">12:00 PM</option>
            <option value="12:15 PM">12:15 PM</option>
            <option value="12:30 PM">12:30 PM</option>
            <option value="12:45 PM">12:45 PM</option>
            <option value="13:00 PM">1:00 PM</option>
            <option value="13:15 PM">1:15 PM</option>
            <option value="13:30 PM">1:30 PM</option>
            <option value="13:45 PM">1:45 PM</option>
            <option value="14:00 PM">2:00 PM</option>
            <option value="14:15 PM">2:15 PM</option>
            <option value="14:30 PM">2:30 PM</option>
            <option value="14:45 PM">2:45 PM</option>
            <option value="15:00 PM">3:00 PM</option>
            <option value="15:15 PM">3:15 PM</option>
            <option value="15:30 PM">3:30 PM</option>
            <option value="15:45 PM">3:45 PM</option>
            <option value="16:00 PM">4:00 PM</option>
            <option value="16:15 PM">4:15 PM</option>
            <option value="16:30 PM">4:30 PM</option>
            <option value="16:45 PM">4:45 PM</option>
            <option value="17:00 PM">5:00 PM</option>
            <option value="17:15 PM">5:15 PM</option>
            <option value="17:30 PM">5:30 PM</option>
            <option value="17:45 PM">5:45 PM</option>
            <option value="18:00 PM">6:00 PM</option>
            <option value="18:15 PM">6:15 PM</option>
            <option value="18:30 PM">6:30 PM</option>
            <option value="18:45 PM">6:45 PM</option>
            <option value="19:00 PM">7:00 PM</option>
            <option value="19:15 PM">7:15 PM</option>
            <option value="19:30 PM">7:30 PM</option>
            <option value="19:45 PM">7:45 PM</option>
            <option value="20:00 PM">8:00 PM</option>
            <option value="20:15 PM">8:15 PM</option>
            <option value="20:30 PM">8:30 PM</option>
            <option value="20:45 PM">8:45 PM</option>
            <option value="21:00 PM">9:00 PM</option>
            <option value="21:15 PM">9:15 PM</option>
            <option value="21:30 PM">9:30 PM</option>
            <option value="21:45 PM">9:45 PM</option>
            <option value="22:00 PM">10:00 PM</option>
          </select>
        </label>
        <label>
          <span class="numpeople">Number of Attendees: <span class="required">*</span></span>
          <input type="text" name="entry.2064814677" id="entry.2064814677" placeholder="Enter number of guaranteed people at the event" maxlength="4" size="4" required>
        </label>

    <div class="container my-5">

            <input type="search" style="" id="myInput" onkeyup="myFunction();" onchange="myFunction();" onkeypress="myFunction();" onpaste="myFunction();" oninput="myFunction();" onsearch="this.onkeyup();" placeholder="Search" title="">

          <!-- Table -->
          <table id="gsheet" class="table table-striped">
            <thead>
              <tr>
                <th>Item</th>
                <th>Options</th>
                <th></th>
                <th></th>
                <th>Price</th>
                <th>Quantity</th>
                <th></th>
                <th>Keywords</th>
              </tr>
            </thead>
            <tbody id="gsheet1"></tbody>
          </table>

        </div>
  
   <div id="divorder">
  <label>
  
    <span>Order Total: </span><span id="totalAmt">$0.00</span>
    <br>
    <br>
    <br>
 
    <span class="displayorder">Order: <br><br>
    </span>
    
    <textarea textarea rows="10" cols="80" wrap="hard" type="text" onkeypress="return false;" name="entry.1873909031" id="entry.1873909031" required></textarea><br>
    <button id="clearbtn" onclick='document.getElementById("entry.1873909031").innerHTML="";total=0;document.getElementById("totalAmt").innerHTML="$"+total.toFixed(2);count=1' type="button">Clear My Order</button>
  </label>
  </div>

  <!-- Hidden total value amount for form data submission -->
  <input type="hidden" name="entry.207412044" id="entry.207412044">

<input type="submit" value="Submit Order" onsubmit="submitted=true;">
</form>
</head>  
  <body>
    <div class="googlecontainer"></div>
    <div class="center">
      <p id="p1">You must sign in to a kellerisd.net account to fill out our online form.<br> For all other order requests, please contact us directly.
        <br><br>Please sign in using the Google Sign-In button below:</p><br><br>
      <div class="g-signin2" id="gSignin" data-onsuccess="onSignIn" data-theme="dark">
      <p id="denymsg"></p>
    </div>
  </div>      

      <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="if(submitted) {}"></iframe>
      
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
      <script type="text/javascript">var submitted=false;</script>
      <script type="text/javascript">
      $('#gform').on('submit', function(e) {
          $(window).scrollTop(0);
          $('#gform *').fadeOut(2000);
          $('#gform').prepend('Your order form has been submitted successfully.');
      });
      </script>
    </body>
    <script>
        document.getElementById("gform").style.display = "none";

      function onSignIn(googleUser) {
        // Useful data for your client-side scripts:
        var profile = googleUser.getBasicProfile();
        //console.log("ID: " + profile.getId()); // Don't send this directly to your server!
        //console.log('Full Name: ' + profile.getName());
        //console.log('Given Name: ' + profile.getGivenName());
        //console.log('Family Name: ' + profile.getFamilyName());
        //console.log("Image URL: " + profile.getImageUrl());
        var email = profile.getEmail();
        if(email.includes("@kellerisd.net"))
        {
            document.getElementById("entry.328273392").value = email;
            console.log(email);
            console.log(document.getElementById("entry.328273392").value);
            document.getElementById("gform").style.display = "block";
            document.getElementById("entry.1350583608").value = profile.getName();
            document.getElementById("entry.1350583608").readOnly = true;
            document.getElementById("gSignin").style.display = "none";
            document.getElementById("p1").style.display = "none";
        }
        else{signOut();
            document.getElementById("denymsg").innerHTML = "Error loading form: You must sign into a kellerisd.net email account. Try again."
        }
      }

    function signOut() {
    var auth2 = gapi.auth2.getAuthInstance();
    auth2.signOut().then(function () {
    document.getElementById("entry.935827892").value = "";
    document.getElementById("entry.1331858140").value = "";
    console.log('User signed out.');
    });
  }

   //setting min max date request to 6 
   var today = new Date();
      var dateMax = new Date();
      var dd = today.getDate();
      var dd2 = dateMax.getDate();
      var mm = today.getMonth()+1; //January is 0!
      var mm2 = dateMax.getMonth()+1;
      var yyyy = today.getFullYear();
      var yyyy2 = dateMax.getFullYear();
      
      if(mm+6 > 12){
        mm2 = mm-6;
        yyyy2 = yyyy+1;
      }else{
        mm2 = mm+6;
      }
  
   if(dd<10){
          dd='0'+dd;
          dd2='0'+dd;
      } 
      if(mm<10){
          mm='0'+mm;
      }
      if(mm2<10){
      mm2='0'+mm2;
      }
  
  today = yyyy+'-'+mm+'-'+dd;
  document.getElementById("entry.454229218").setAttribute("min", today);
  dateMax = yyyy2+'-'+mm2+'-'+dd2;
  document.getElementById("entry.454229218").setAttribute("max", dateMax);
    
      let xmlhttp = new XMLHttpRequest();
      var itemQty = [];
      var item = [];
      var options1 = [];
      var options2 = [];
      var options3 = [];
      var price = [];
      var keywords = [];
      var count = 1;
      var total=0;
      
      
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          let data = JSON.parse(this.responseText).feed.entry;
          let i, j,k;
  
  
          for (i = 0; i < data.length; i++) {
            item.push(data[i]["gsx$item"]["$t"]);
            options1.push(data[i]["gsx$options1"]["$t"]);
            options2.push(data[i]["gsx$options2"]["$t"]);
            options3.push(data[i]["gsx$options3"]["$t"]);
            price.push(data[i]["gsx$price"]["$t"]);
            keywords.push(data[i]["gsx$keywords"]["$t"]);
  
            let qty, btn;
            let optionsList1 = [];
            let optionsList2 = [];
            let optionsList3 = [];
            let optionsDropdown1 = "";
            let optionsDropdown2 = "";
            let optionsDropdown3 = "";
            itemQty[i] = 0;
  
            //split options into a list which is reset in forloop. catch empty string as null ie. no options for that item
            optionsList1 = options1[i].split(",");
            if (options1[i].split(",") == "") {
              optionsList1 = null;
            }
            optionsList2 = options2[i].split(",");
            if (options2[i].split(",") == "") {
              optionsList2 = null;
            }
            optionsList3 = options3[i].split(",");
            if (options3[i].split(",") == "") {
              optionsList3 = null;
            }
  
            // if optionsList is not null/empty then now its time to make the option list
            if (optionsList1) {
              //outside for-loop need to begin dropdown tag
              optionsDropdown1 += "<select id='opt1" + i + "''>";
  
              //for loop going through the comma , separated list of options
              for (j = 0; j < optionsList1.length; j++) {
  
                //call each option from array and add to dropdown
                optionsDropdown1 += "<option>" + optionsList1[j] + "</option>";
  
              }
              //outside end of for-loop leave tailing/end dropdown tag
              optionsDropdown1 += "</select>";
            } else {
              //empty list - no option/dropdown desired
              optionsDropdown1 = "";
            }
            if (optionsList2) {
              //outside for-loop need to begin dropdown tag
              optionsDropdown2 += "<select id='opt2" + i + "''>";
  
              //for loop going through the comma , separated list of options
              for (j = 0; j < optionsList2.length; j++) {
  
                //call each option from array and add to dropdown
                optionsDropdown2 += "<option>" + optionsList2[j] + "</option>";
  
              }
              //outside end of for-loop leave tailing/end dropdown tag
              optionsDropdown2 += "</select>";
            } else {
              //empty list - no option/dropdown desired
              optionsDropdown2 = "";
            }
            if (optionsList3) {
              //outside for-loop need to begin dropdown tag
              optionsDropdown3 += "<select id='opt3" + i + "''>";
  
              //for loop going through the comma , separated list of options
              for (j = 0; j < optionsList3.length; j++) {
  
                //call each option from array and add to dropdown
                optionsDropdown3 += "<option>" + optionsList3[j] + "</option>";
  
              }
              //outside end of for-loop leave tailing/end dropdown tag
              optionsDropdown3 += "</select>";
            } else {
              //empty list - no option/dropdown desired
              optionsDropdown3 = "";
            }
            
            qty = "<select onchange='setQty(" + i + ")' id='qty" + i + "'><option value='0'>---</option>"
           for (k=1;k<=200;k++)
           {
             qty+="<option value='"+k+"''>"+k+"</option>";
           }
  
            btn = "<button onclick='addToOrder(" + i + ")'type='button'>Add</button>"
  
            document.getElementById("gsheet1").innerHTML +=
              "<tr>" +
              "<td>" +
              item[i] +
              "</td>" +
              "<td>" +
              optionsDropdown1 +
              "</td>" +
              "<td>" +
              optionsDropdown2 +
              "</td>" +
              "<td>" +
              optionsDropdown3 +
              "</td>" +
              "<td>" +
              price[i] +
              "</td>" +
              "<td>" +
              qty +
              "</td>" +
              "<td>" +
              btn +
              "</td>" +
              "<td>" +
              keywords[i] +
              "</td>" +
              "</tr>";
              
              price[i]= price[i].replace(/[$]/g, "");
          }
        }
      };
  
      xmlhttp.open(
        "GET",
        "https://spreadsheets.google.com/feeds/list/15gT8DzszGlCgqA4QOU_rVssCSEWGxniuBiqDSbOwI8Y/3/public/full?alt=json",
        true
      );
      xmlhttp.send();
  
      function setQty(selection) {
        itemQty[selection] = document.getElementById("qty" + selection).value;
      }
      
      function myFunction() {
          var input, filter, table, tr, td, cell, i, j;
          input = document.getElementById("myInput");
          filter = input.value.toUpperCase();
          table = document.getElementById("gsheet");
          tr = table.getElementsByTagName("tr");
          for (i = 1; i < tr.length; i++) {
  
            tr[i].style.display = "none";
  
            td = tr[i].getElementsByTagName("td");
            for (var j = 0; j < td.length; j++) {
              cell = tr[i].getElementsByTagName("td")[j];
              if (cell) {
                if (cell.innerHTML.toUpperCase().indexOf(filter) > -1) {
                  tr[i].style.display = "";
                  break;
                }
              }
            }
          }
  
        }    
      
  
      function addToOrder(myItem) 
      {
        var myOption;
        if(document.getElementById("opt1"+myItem)){
          myOption = " with ";
          myOption +=  document.getElementById("opt1"+myItem).value;
          if(document.getElementById("opt2"+myItem)){
          myOption +=  ", " + document.getElementById("opt2"+myItem).value;
          }
          if(document.getElementById("opt3"+myItem)){
          myOption +=  ", " + document.getElementById("opt3"+myItem).value;
          }
        }else{myOption="";}
        
        if (itemQty[myItem] > 0) 
        {
          document.getElementById("entry.1873909031").innerHTML += 
          count + ". " + item[myItem] + myOption +
          "\nQuantity: " + itemQty[myItem] + "\n\n"
          count++;
          document.getElementById("qty"+myItem).selectedIndex = 0;
          total += itemQty[myItem]*price[myItem];
          if(document.getElementById("opt1"+myItem))
          {
            alert(item[myItem] + " with " + myOption + " (" + itemQty[myItem] + ")" + " has been added to your order.\n\nYour total is currently: " + "$" + total.toFixed(2));
          }else{
            alert(item[myItem] + " (" + itemQty[myItem] + ")" + " has been added to your order.\n\nYour total is currently: " + "$" + total.toFixed(2));
          }
          
          document.getElementById("totalAmt").innerHTML = "$" + total.toFixed(2);
          document.getElementById('entry.207412044').value = document.getElementById('totalAmt').innerHTML;
          console.log(document.getElementById('entry.207412044').value);
        }
        
      }

    </script>
    
</html>
